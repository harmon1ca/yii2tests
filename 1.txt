SELECT `trip`.* FROM `trip` JOIN `trip_service` ON `trip`.`id`=`trip_service`.`trip_id` JOIN (SELECT `flight_id` FROM `cbt`.`flight_segment` WHERE `arrAirportId` = (SELECT `airport_id` FROM `nemo_guide_etalon`.`airport_name` WHERE `value` LIKE '%Домодедово, Москва%')) as `flight_id` ON `trip_service`.id = `flight_id` WHERE `trip`.`corporate_id`=3 AND `trip_service`.`service_id` = 2